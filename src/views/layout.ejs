<!--
  File: views/layout.ejs
  
  Mô tả: Layout template chính cho toàn bộ ứng dụng
  - Định nghĩa cấu trúc HTML chung: head, navigation, flash messages, main content, footer
  - Navigation bar với menu theo role (admin, owner, user)
  - Floating chat widget (chatbot) tích hợp n8n
  - Custom center modal (popup trung tâm)
  - Flash messages (error, success) từ connect-flash
  
  Công nghệ sử dụng:
  - EJS: Template engine để render HTML động
  - Bootstrap 5: Framework CSS và JavaScript cho UI components
  - Font Awesome: Icons
  - Google Fonts (Inter): Typography
  - Express EJS Layouts: Layout system
-->

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'Voucher Management System' %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" <% if (!user || user.role !== 'owner') { %>href="/"<% } %>>
                <i class="fas fa-ticket-alt me-2"></i>
                Vivudulich
            </a>
            <% if (!user || user.role !== 'owner') { %>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
            <% } %>
            <div class="collapse navbar-collapse" id="navbarNav">
                <% if (!user || user.role !== 'owner') { %>
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item"><a class="nav-link" href="/">Trang chủ</a></li>
                        <li class="nav-item"><a class="nav-link" href="/locations">Địa điểm</a></li>
                        <li class="nav-item"><a class="nav-link" href="/vouchers">Voucher</a></li>
                    </ul>
                <% } %>
                <ul class="navbar-nav <%= user && user.role === 'owner' ? 'ms-auto' : '' %>">
                    <% if (user) { %>
                        <% if (user.role === 'admin') { %>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-cog me-1"></i>Admin
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/admin/dashboard">Dashboard</a></li>
                                    <li><a class="dropdown-item" href="/admin/users">Quản lý Users</a></li>
                                    <li><a class="dropdown-item" href="/admin/locations">Quản lý Địa điểm</a></li>
                                    <li><a class="dropdown-item" href="/admin/vouchers">Quản lý Voucher</a></li>
                                    <li><a class="dropdown-item" href="/admin/reviews">Quản lý Reviews</a></li>
                                </ul>
                            </li>
                        <% } else if (user.role === 'owner') { %>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-store me-1"></i>Owner
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/owner/profile">Thông tin cá nhân</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="/owner/dashboard">Dashboard</a></li>
                                    <li><a class="dropdown-item" href="/owner/locations">Địa điểm của tôi</a></li>
                                    <li><a class="dropdown-item" href="/owner/vouchers">Voucher của tôi</a></li>
                                    <li><a class="dropdown-item" href="/owner/reviews">Đánh giá mới nhất</a></li>
                                </ul>
                            </li>
                        <% } else { %>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-store me-1"></i>User
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/profile">Thông tin cá nhân</a></li>
                                </ul>
                            </li>
                        <% } %>
                        <li class="nav-item">
                            <form action="/logout" method="POST" class="d-inline">
                                <button type="submit" class="btn btn-outline-light btn-sm" style="top:4px">
                                    <i class="fas fa-sign-out-alt me-1"></i>Đăng xuất
                                </button>
                            </form>
                        </li>
                    <% } else { %>
                        <li class="nav-item">
                            <a class="nav-link" href="/auth">
                                <i class="fas fa-sign-in-alt me-1"></i>Đăng nhập
                            </a>
                        </li>
                    <% } %>
                </ul>
            </div>
        </div>
    </nav>

    <% if (typeof error !== 'undefined' && error.length > 0) { %>
        <div class="alert alert-danger alert-dismissible fade show m-3" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i><%= error %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    <% } %>
    <% if (typeof success !== 'undefined' && success.length > 0) { %>
        <div class="alert alert-success alert-dismissible fade show m-3" role="alert">
            <i class="fas fa-check-circle me-2"></i><%= success %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    <% } %>

    <main class="container my-4">
        <%- body %>
    </main>

    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Voucher Management System</h5>
                    <p class="mb-0">Hệ thống quản lý voucher và địa điểm</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">&copy; Đề tài được làm bởi Nguyễn Ngọc Tâm</p>
                </div>
            </div>
        </div>
    </footer>

    <button id="floating-message-btn" class="floating-message-btn" aria-label="Chat">
        <i class="fas fa-comment-dots"></i>
    </button>
    <div id="floating-chat-panel" class="floating-chat-panel" aria-live="polite" aria-label="Hộp thoại chat">
        <div class="floating-chat-header">Chatbot</div>
        <div id="floating-chat-body" class="floating-chat-body">
            <div class="text-muted small">Chào bạn, mình là Thổ Địa của web này. Mình có thể giúp bạn tìm kiếm địa điểm theo yêu cầu, bạn càng miêu tả rõ thì kết quả cảng chính xác.</div>
        </div>
        <button id="floating-chat-scroll-btn" type="button" class="floating-chat-scroll-btn">
            <i class="fas fa-arrow-down"></i>
        </button>
        <form id="floating-chat-form" class="floating-chat-form">
            <input id="floating-chat-input" type="text" class="floating-chat-input" placeholder="Write a message..." required />
            <button type="submit" class="chat-send-btn" aria-label="Send"><i class="fas fa-angle-right"></i></button>
        </form>
    </div>

    <div id="center-modal-backdrop" class="center-modal-backdrop" style="display:none;">
        <div id="center-modal" class="center-modal" role="dialog" aria-modal="true" aria-hidden="true">
            <button type="button" class="center-modal-close" aria-label="Đóng">&times;</button>
            <div id="center-modal-content" class="center-modal-content"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/qrcode.min.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>
